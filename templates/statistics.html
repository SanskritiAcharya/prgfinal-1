{% extends "base.html" %}

{% block title %}Statistics - Ecotrack{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">Your Waste Statistics</h1>
    
    <div class="stats-overview">
        <div class="stat-box">
            <h3>{{ total_entries }}</h3>
            <p>Total Entries</p>
        </div>
        <div class="stat-box">
            <h3>{{ "%.2f"|format(total_weight) }} kg</h3>
            <p>Total Waste</p>
        </div>
        <div class="stat-box">
            <h3>{{ recycled_count }}</h3>
            <p>Items Recycled</p>
        </div>
        <div class="stat-box">
            <h3>{{ "%.2f"|format(recycled_weight) }} kg</h3>
            <p>Recycled Weight</p>
        </div>
    </div>

    <div class="charts-container">
        <div class="chart-card">
            <h2>Waste by Type</h2>
            <canvas id="wasteTypeChart"></canvas>
        </div>
        
        <div class="chart-card">
            <h2>Monthly Waste Trend</h2>
            <canvas id="monthlyChart"></canvas>
        </div>
    </div>

    <div class="impact-section">
        <h2>Environmental Impact</h2>
        <div class="impact-grid">
            <div class="impact-card">
                <div class="impact-icon">üå±</div>
                <h3>{{ "%.2f"|format(co2_saved) }} kg</h3>
                <p>CO‚ÇÇ Saved</p>
                {% if potential_co2 > 0 %}
                <small style="color: var(--text-light); margin-top: 0.5rem; display: block;">
                    Potential: +{{ "%.2f"|format(potential_co2) }} kg
                </small>
                {% endif %}
            </div>
            <div class="impact-card">
                <div class="impact-icon">üå≥</div>
                <h3>{{ "%.1f"|format(trees_saved) }}</h3>
                <p>Trees Saved</p>
                {% if potential_trees > 0 %}
                <small style="color: var(--text-light); margin-top: 0.5rem; display: block;">
                    Potential: +{{ "%.1f"|format(potential_trees) }}
                </small>
                {% endif %}
            </div>
            <div class="impact-card">
                <div class="impact-icon">‚ôªÔ∏è</div>
                <h3>{{ recycling_rate }}%</h3>
                <p>Recycling Rate</p>
                {% if recycling_rate < 50 and total_entries > 0 %}
                <small style="color: var(--text-light); margin-top: 0.5rem; display: block;">
                    Keep recycling! üåç
                </small>
                {% endif %}
            </div>
        </div>
        {% if potential_co2 > 0 or potential_trees > 0 %}
        <div class="potential-impact" style="margin-top: 2rem; padding: 1.5rem; background: var(--light-bg); border-radius: 12px; border-left: 4px solid var(--warning-color);">
            <h3 style="margin-bottom: 0.5rem; color: var(--dark-color);">üí° Potential Impact</h3>
            <p style="color: var(--text-color); margin-bottom: 0.5rem;">
                You have recyclable items that haven't been marked as recycled yet.
            </p>
            <p style="color: var(--text-light); font-size: 0.9rem;">
                Mark them as recycled in the "Track Waste" page to see your full environmental impact! Every item counts. üå±
            </p>
        </div>
        {% endif %}
    </div>

    <div class="export-section">
        <a href="{{ url_for('export_data') }}" class="btn btn-primary">üì• Export Data (CSV)</a>
    </div>
</div>

<script>
// Waste by Type Chart
const wasteTypeData = {{ waste_by_type|tojson }};
const typeLabels = Object.keys(wasteTypeData);
const typeWeights = typeLabels.map(type => wasteTypeData[type].weight);

const ctx1 = document.getElementById('wasteTypeChart').getContext('2d');
new Chart(ctx1, {
    type: 'doughnut',
    data: {
        labels: typeLabels.map(t => t.charAt(0).toUpperCase() + t.slice(1)),
        datasets: [{
            data: typeWeights,
            backgroundColor: [
                '#2ecc71',
                '#3498db',
                '#e74c3c',
                '#95a5a6'
            ]
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true
    }
});

// Monthly Trend Chart
const monthlyData = {{ monthly_stats|tojson }};
const monthLabels = Object.keys(monthlyData).sort();
const monthWeights = monthLabels.map(month => monthlyData[month].weight);

const ctx2 = document.getElementById('monthlyChart').getContext('2d');
new Chart(ctx2, {
    type: 'line',
    data: {
        labels: monthLabels,
        datasets: [{
            label: 'Waste (kg)',
            data: monthWeights,
            borderColor: '#2ecc71',
            backgroundColor: 'rgba(46, 204, 113, 0.1)',
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
{% endblock %}


