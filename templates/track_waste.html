{% extends "base.html" %}

{% block title %}Track Waste - Ecotrack{% endblock %}

{% block extra_head %}
<style>
    .waste-lifecycle {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin: 2rem 0;
    }
    
    .lifecycle-stage {
        background: var(--card-bg, #ffffff);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-top: 4px solid;
    }
    
    .stage-new {
        border-top-color: #3498db;
    }
    
    .stage-waiting {
        border-top-color: #f39c12;
    }
    
    .stage-disposed {
        border-top-color: #27ae60;
    }
    
    .stage-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border-color, #e0e0e0);
    }
    
    .stage-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-primary, #333);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .stage-count {
        background: var(--primary-color, #3498db);
        color: white;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
    }
    
    .stage-new .stage-count {
        background: #3498db;
    }
    
    .stage-waiting .stage-count {
        background: #f39c12;
    }
    
    .stage-disposed .stage-count {
        background: #27ae60;
    }
    
    .waste-entry-card {
        background: var(--bg-light, #f8f9fa);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 3px solid;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .waste-entry-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .entry-new {
        border-left-color: #3498db;
    }
    
    .entry-waiting {
        border-left-color: #f39c12;
    }
    
    .entry-disposed {
        border-left-color: #27ae60;
    }
    
    .entry-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 0.5rem;
    }
    
    .entry-type {
        font-weight: 600;
        color: var(--text-primary, #333);
    }
    
    .entry-date {
        font-size: 0.85rem;
        color: var(--text-light, #666);
    }
    
    .entry-details {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 0.5rem;
        font-size: 0.9rem;
        color: var(--text-secondary, #555);
        margin-top: 0.5rem;
    }
    
    .entry-details strong {
        color: var(--text-primary, #333);
    }
    
    .entry-status-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-top: 0.5rem;
    }
    
    .badge-new {
        background: #e3f2fd;
        color: #1976d2;
    }
    
    .badge-waiting {
        background: #fff3e0;
        color: #e65100;
    }
    
    .badge-disposed {
        background: #e8f5e9;
        color: #2e7d32;
    }
    
    .status-update-info {
        font-size: 0.8rem;
        color: var(--text-light, #666);
        margin-top: 0.5rem;
        font-style: italic;
    }
    
    .empty-stage {
        text-align: center;
        padding: 2rem;
        color: var(--text-light, #999);
        font-style: italic;
    }
    
    .lifecycle-arrow {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: var(--text-light, #ccc);
        margin: 0 0.5rem;
    }
    
    @media (max-width: 768px) {
        .waste-lifecycle {
            grid-template-columns: 1fr;
        }
        
        .lifecycle-arrow {
            transform: rotate(90deg);
            margin: 0.5rem 0;
        }
    }
    
    .tracking-form-card {
        margin-bottom: 2rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">Track Your Waste</h1>
    
    <div class="waste-tracking-container">
        <div class="tracking-form-card">
            <h2>Add New Waste Entry</h2>
            <form method="POST" action="{{ url_for('track_waste') }}">
                <div class="form-group">
                    <label for="waste_type">Waste Type</label>
                    <select id="waste_type" name="waste_type" required>
                        <option value="">Select waste type</option>
                        <option value="organic">Organic</option>
                        <option value="recyclable">Recyclable</option>
                        <option value="hazardous">Hazardous</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="weight_kg">Weight (kg)</label>
                    <input type="number" id="weight_kg" name="weight_kg" step="0.1" min="0" placeholder="e.g., 2.5">
                </div>
                <div class="form-group">
                    <label for="description">Description (Optional)</label>
                    <textarea id="description" name="description" rows="3" placeholder="Additional details about the waste..."></textarea>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="recycled" name="recycled" value="1">
                        <span>This waste was recycled ‚ôªÔ∏è</span>
                    </label>
                    <small style="display: block; margin-top: 0.5rem; color: var(--text-light);">
                        Check this if you recycled this waste item
                    </small>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Add Entry</button>
            </form>
        </div>

        <div class="waste-lifecycle-container">
            <h2 style="margin-bottom: 1.5rem; text-align: center;">Waste Lifecycle Tracking</h2>
            <p style="text-align: center; color: var(--text-secondary, #666); margin-bottom: 2rem;">
                Track your waste as it moves through different stages: <strong>New Waste</strong> ‚Üí <strong>Waiting Waste</strong> ‚Üí <strong>Disposed Waste</strong>
            </p>
            
            <div class="waste-lifecycle">
                <!-- New Waste Stage -->
                <div class="lifecycle-stage stage-new">
                    <div class="stage-header">
                        <div class="stage-title">
                            <span>üÜï</span>
                            <span>New Waste</span>
                        </div>
                        <span class="stage-count">{{ new_entries|length }}</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-secondary, #666); margin-bottom: 1rem;">
                        Recently logged waste entries awaiting action
                    </p>
                    {% if new_entries %}
                        {% for entry in new_entries %}
                        <div class="waste-entry-card entry-new">
                            <div class="entry-header">
                                <span class="entry-type">{{ entry.waste_type|title }}</span>
                                <span class="entry-date">{{ entry.disposal_date.strftime('%Y-%m-%d %H:%M') }}</span>
                            </div>
                            <div class="entry-details">
                                <strong>Weight:</strong> <span>{{ entry.weight_kg or 'N/A' }} kg</span>
                                {% if entry.description %}
                                <strong>Description:</strong> <span>{{ entry.description }}</span>
                                {% endif %}
                                <strong>Recycled:</strong> <span>{{ 'Yes' if entry.recycled else 'No' }}</span>
                            </div>
                            <span class="entry-status-badge badge-new">Status: New</span>
                            {% if entry.status_updated_at %}
                            <div class="status-update-info">
                                Last updated: {{ entry.status_updated_at.strftime('%Y-%m-%d %H:%M') }}
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-stage">No new waste entries</div>
                    {% endif %}
                </div>

                <!-- Waiting Waste Stage -->
                <div class="lifecycle-stage stage-waiting">
                    <div class="stage-header">
                        <div class="stage-title">
                            <span>‚è≥</span>
                            <span>Waiting Waste</span>
                        </div>
                        <span class="stage-count">{{ waiting_entries|length }}</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-secondary, #666); margin-bottom: 1rem;">
                        Waste that has been scheduled or is pending collection/processing
                    </p>
                    {% if waiting_entries %}
                        {% for entry in waiting_entries %}
                        <div class="waste-entry-card entry-waiting">
                            <div class="entry-header">
                                <span class="entry-type">{{ entry.waste_type|title }}</span>
                                <span class="entry-date">{{ entry.disposal_date.strftime('%Y-%m-%d %H:%M') }}</span>
                            </div>
                            <div class="entry-details">
                                <strong>Weight:</strong> <span>{{ entry.weight_kg or 'N/A' }} kg</span>
                                {% if entry.description %}
                                <strong>Description:</strong> <span>{{ entry.description }}</span>
                                {% endif %}
                                <strong>Recycled:</strong> <span>{{ 'Yes' if entry.recycled else 'No' }}</span>
                            </div>
                            <span class="entry-status-badge badge-waiting">Status: Waiting</span>
                            {% if entry.status_updated_at %}
                            <div class="status-update-info">
                                Updated: {{ entry.status_updated_at.strftime('%Y-%m-%d %H:%M') }}
                                {% if entry.status_updater %}
                                by {{ entry.status_updater.username }}
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-stage">No waiting waste entries</div>
                    {% endif %}
                </div>

                <!-- Disposed Waste Stage -->
                <div class="lifecycle-stage stage-disposed">
                    <div class="stage-header">
                        <div class="stage-title">
                            <span>‚úÖ</span>
                            <span>Disposed Waste</span>
                        </div>
                        <span class="stage-count">{{ disposed_entries|length }}</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-secondary, #666); margin-bottom: 1rem;">
                        Waste that has been successfully collected and disposed or recycled
                    </p>
                    {% if disposed_entries %}
                        {% for entry in disposed_entries %}
                        <div class="waste-entry-card entry-disposed">
                            <div class="entry-header">
                                <span class="entry-type">{{ entry.waste_type|title }}</span>
                                <span class="entry-date">{{ entry.disposal_date.strftime('%Y-%m-%d %H:%M') }}</span>
                            </div>
                            <div class="entry-details">
                                <strong>Weight:</strong> <span>{{ entry.weight_kg or 'N/A' }} kg</span>
                                {% if entry.description %}
                                <strong>Description:</strong> <span>{{ entry.description }}</span>
                                {% endif %}
                                <strong>Recycled:</strong> <span>{{ 'Yes' if entry.recycled else 'No' }}</span>
                            </div>
                            <span class="entry-status-badge badge-disposed">Status: Disposed</span>
                            {% if entry.status_updated_at %}
                            <div class="status-update-info">
                                Completed: {{ entry.status_updated_at.strftime('%Y-%m-%d %H:%M') }}
                                {% if entry.status_updater %}
                                by {{ entry.status_updater.username }}
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-stage">No disposed waste entries</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
